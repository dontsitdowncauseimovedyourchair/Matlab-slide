clc; clear; clf; close all;
theta = pi/4;
h = 5;
D = 50;
R0 = h/(1-cos(theta));
yoffset = 5;

syms s x1(s) y1(s) x2(s) y2(s) rizo1x(s) rizo1y(s) lineax(s) lineay(s) lineax2(s) lineay2(s) lineaxd1(s) lineayd1(s) lineax3(s) lineay3(s) rizo2x(s) rizo2y(s) lineax4(s) lineay4(s) lineaxd2(s) lineayd2(s) lineay5(s) lineax5(s) rizo3y(s) rizo3x(s) lineax6(s) lineay6(s) lineaxdp(s) lineaydp(s) x(s) y(s) 

%Bajada
x1(s)= s*cos(theta); 
y1(s)= yoffset + h+D*cos(theta) - s*sin(theta);

%Curva bb
x2(s)= D*cos(theta) + R0*sin(theta) - R0*sin(theta-(s-D)/R0);
y2(s) = yoffset + R0 - R0*cos(theta-(s-D)/R0);

%Radio del Rizo Mayor
r = 15;

%Primera Linea Rizo 1
lineax(s) = s - (D+theta*R0) + D*cos(theta) + R0*sin(theta);
lineay(s) = yoffset;

%Rizo 1
theta2 = (s - (D+theta*R0+r))/r;
rizo1x(s) = lineax(D+theta*R0+r) + r * cos(theta2 - pi/2);
rizo1y(s) = yoffset + r + r * sin(theta2 - pi/2);

%Segunda Linea Rizo 1
lineax2(s) = s - (D+theta*R0+r+2*pi*r) + lineax(D+theta*R0+r);
lineay2(s) = yoffset;

%Distancia d
d = 4;

%Linea d
lineaxd1(s) = s - (D+theta*R0+r+2*pi*r+r) + lineax2(D+theta*R0+r+2*pi*r+r);
lineayd1(s) = yoffset;

%Primera LÃ­nea Rizo 2
lineax3(s) = s - (D+theta*R0+r+2*pi*r+r+d) + lineaxd1(D+theta*R0+r+2*pi*r+r+d);
lineay3(s) = yoffset;

%Radio del Rizo 2
r2 = (2/3)*r;

%Rizo 2
theta3 = (s - (D+theta*R0+r+2*pi*r+r+d+r2))/r2;
rizo2x(s) = lineax3(D+theta*R0+r+2*pi*r+r+d+r2) + r2 * cos(theta3 - pi/2);
rizo2y(s) = yoffset + r2 + r2 * sin(theta3 - pi/2);

%Segunda Linea Rizo 2
lineax4(s) = s - (D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2) + lineax3(D+theta*R0+r+2*pi*r+r+d+r2);
lineay4(s) = yoffset;

%linea d2
lineaxd2(s) = s - (D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2) + lineax4(D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2);
lineayd2(s) = yoffset;

%Radio del Rizo 3
r3 = (2/3)*r2;

%Primera linea Rizo 3
lineax5(s) = s - (D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d) + lineaxd2(D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d);
lineay5(s) = yoffset;

%Rizo 3
theta4 = (s - (D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3))/r3;
rizo3x(s) = lineax5(D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3) + r3 * cos(theta4 - pi/2);
rizo3y(s) = yoffset + r3 + r3 * sin(theta4 - pi/2);

%Segunda linea Rizo 3
lineax6(s) = s - (D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3) + lineaxd2(D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3);
lineay6(s) = yoffset;

%d prima
dprima = 10;

%Linea d prima
lineaxdp(s) = s - (D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3) + lineax6(D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3);
lineaydp(s) = yoffset;

x(s)= piecewise(0<=s<D, x1(s), D <= s < D+theta*R0, x2(s), ...
    D+theta*R0 <= s < (D+theta*R0)+r, lineax(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    (D+theta*R0)+r <= s < ((D+theta*R0)+r)+2*pi*r, rizo1x(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r <= s < ((D+theta*R0)+r)+2*pi*r+r, lineax2(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r <= s < ((D+theta*R0)+r)+2*pi*r+r+d, lineaxd1(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2, lineax3(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2, rizo2x(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2, lineax4(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d, lineaxd2(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3, lineax5(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3, rizo3x(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3, lineax6(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3+2*pi*r3, lineaxdp(s));                                                                                                                                                                   ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
y(s)= piecewise(0<=s<D, y1(s), D <= s < D+theta*R0, y2(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    D+theta*R0 <= s < (D+theta*R0)+r, lineay(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    (D+theta*R0)+r <= s < ((D+theta*R0)+r)+2*pi*r, rizo1y(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r <= s < ((D+theta*R0)+r)+2*pi*r+r, lineay2(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r <= s < ((D+theta*R0)+r)+2*pi*r+r+d, lineayd1(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2, lineay3(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2, rizo2y(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2, lineay4(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d, lineayd2(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3, lineay5(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3, rizo3y(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3, lineay6(s), ...                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3 <= s < ((D+theta*R0)+r)+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+2*pi*r3+r3+2*pi*r3, lineaydp(s));                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
corte = D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2+r2+d+r3+23*(2*pi*r3)/100;                                                                                                                                                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      

fplot(x,y, [0,corte])
xlim([0,150])
ylim([0,50])
daspect([1,1,1])
figure(1)

iteraciones = 2000; %Iteraciones del tobogÃ¡n
iteracioness = 500; %Iteraciones del tiro parabÃ³lico

posX = zeros(1, iteraciones + iteracioness);
posY = zeros(1, iteraciones + iteracioness);
posX(1) = double(x(0));
posY(1) = double(y(0));

v = zeros(1, iteraciones + iteracioness);
v(1) = 1;
g = 9.81;
mu = 0.01;

a = zeros(1, iteraciones + iteracioness);
a(1) = g*(sin(theta) - mu * cos(theta));

ac = zeros(1, iteraciones + iteracioness);
ac(1) = 0;

a_tangencial = 0;
a_centripeda = 0;
a_theta = 0;

masa = 70;
Wf = zeros(1, iteraciones + iteracioness); %Trabajos de la FricciÃ³n
Wf(1) = mu * masa * g * double(x(1) - double(x(0)));

ep = zeros(1, iteraciones + iteracioness); %EnergÃ­a Potencial
ep(1) = masa * g * posY(1);

ek = zeros(1, iteraciones + iteracioness); %EnergÃ­a CinÃ©tica
ek(1) = (1/2)*masa*(v(1)^2);

em = zeros(1, iteracioness);
em(1) = ek(1) + ep(1); %EnergÃ­a inicial del sistema.

ed = zeros(1, iteraciones + iteracioness); %EnergÃ­a Disipada
ed(1) = 0; %Al inicio no hay pÃ©rdida de energÃ­a

delta = 0.01;

t = zeros(1, iteraciones + iteracioness);
t(1) = delta;

parar = 0;
ese = 0;

for i=2:iteraciones %TobogÃ¡n
    ese = ese + v(i-1) * delta;
    posX(i) = double(x(ese));
    posY(i) = double(y(ese));

    if (posX(i) > round(double(x(D+theta*R0)))) %FricciÃ³n cuando pasamos la rampa inicial
        if posY(i) ~= yoffset 
            mu = 0.01; %FricciÃ³n en rizos
        else 
            mu = 0.3; %FricciÃ³n en secciones planas
        end
    end

    v(i) = sqrt(2*g*(posY(i-1) - posY(i)) + (v(i-1).^2) - 2*mu*g*abs(posX(i) - posX(i-1)));

    Wf(i) = mu * masa * g * (posX(i) - posX(i-1));

    %CÃ¡lculo de aceleraciones
    if (posY(i) == yoffset) %Lineas Rectas
        a(i) = (posX(i) - posX(i-1))/delta;
        ac(i) = 0; 
    else
        if (posX(i) < round(double(x(D)))) %Rampa inicial
            a_theta = theta;
            a(i) = (posX(i) - posX(i-1))/delta;
            ac(i) = 0;
        elseif (posX(i) < round(double(x(D+theta*R0)))) %SecciÃ³n Curva
            a(i) = (posX(i) - posX(i-1))/delta;
            ac(i) = ((v(i))^2) / R0;
        elseif (posX(i) < round(double(x(D+theta*R0+r+2*pi*r)))) %Primer Rizo
            a(i) = (posX(i) - posX(i-1))/delta;
            ac(i) = ((v(i))^2) / r;
        elseif (posX(i) < round(double(x(D+theta*R0+r+2*pi*r+r+d+r2+2*pi*r2)))) %Segundo Rizo         
            a(i) = (posX(i) - posX(i-1))/delta;                            
            ac(i) = ((v(i))^2) / r2;
        else %Tercer rizo
            a(i) = (posX(i) - posX(i-1))/delta;
            ac(i) = ((v(i))^2) / r3;
        end
    end

    ek(i) = (1/2)*(masa*(v(i))^2);
    ep(i) = masa*g*(posY(i)-yoffset);
    em(i) = ek(i) + ep(i);
    ed(i) = em(1) - (ek(i) + ep(i));

    t(i) = t(i-1) + delta;

    if (ese) >= (corte)
        parar = i;
        theta = atan((posY(i)-posY(i-1))/(posX(i)-posX(i-1))); %Calcular el Ã¡ngulo de salida
        break;
    end 
end   
                                                                                                                                                                                                                                                                                                                 
vx = v(parar) * cos(theta);
vy = v(parar) * sin(theta);
mu = 0.1;
ax = -mu/masa * vx;
ay = -g - (mu/masa * vy);
pararr = 0;

for i=1:iteracioness
    posX(parar + i) = posX(parar + i-1) + delta * vx;
    posY(parar + i) = posY(parar + i-1) + delta * vy;

    vx = vx + delta * ax;
    vy = vy + delta * ay;
    v(parar + i) = sqrt(vx^2 + vy^2);

    ax = -mu/masa * vx;
    ay = -g - (mu/masa * vy);
    a(parar + i) = -sqrt(ax^2 + ay^2);

    ek(parar + i) = (1/2)*(masa*(sqrt((vx)^2 + (vy)^2))^2);
    ep(parar + i) = masa*g*(posY(parar + i)-yoffset);
    em(parar + i) = ek(parar + i) + ep(parar + i);
    ed(parar + i) = em(1) - (ek(parar + i) + ep(parar + i));

    t(parar + i) = t(parar + i-1) + delta;

    Wf(parar + i) = mu * masa * g * (posX(parar + i) - posX(parar + i-1));

    if (posY(parar + i) <= 0)
        pararr = parar + i; %Iteraciones de todo el recorrido :D
        break;
    end
end



hold on
daspect([1,1,1]);

zonaAterrizajeX = [posX(parar)+abs(posX(parar)-posX(pararr))-2, posX(parar)+abs(posX(parar)-posX(pararr))+2, posX(parar)+abs(posX(parar)-posX(pararr))+2, posX(parar)+abs(posX(parar)-posX(pararr))-2];
zonaAterrizajeY = [1, 1, 0, 0];
fill(zonaAterrizajeX, zonaAterrizajeY, "r");

%Cajita
h1 = animatedline('Marker', 'o', "Color", "b");
h2 = animatedline(posX(1), posY(1), 'LineStyle', '--', "LineWidth", 3, "Color", "r"); %DiseÃ±o NavideÃ±o :D
valores = sprintf('x = %0.2f m \ny = %0.2f m \nv = %.2f m/s \na = %.2f m/s^2 \nac = %0.2f m/s^2 \nek = %.2f J \nep = %.2f J \nem = %.2f J\nWf = %.2f J\ned = %0.2f J\nt = %.2f s', posX(1), posY(1), v(1), a(1), ek(1), ep(1), (ek(1) + ep(1)), Wf(1), ed(1), t(1));
valoress = sprintf('Distancia desde la zona de lanzamiento: %0.2f m', corte - posX(1));
cajita = annotation("textbox", [0.7, 0.6, 0.1, 0.1], 'String', valores);
cajita2 = annotation("textbox", [0.4, 0.1, 0.1, 0.1], 'String', valoress);


for i=1:iteraciones + iteracioness
    clearpoints(h1)
    addpoints(h1,posX(i),posY(i));
    addpoints(h2,posX(i),posY(i));
    drawnow
    pause(0.001)
    str = sprintf("TobogÃ¡n 2/3");
    title(str)
    valores = sprintf('x = %0.2f m\ny = %0.2f m\nv = %.2f m/s\na = %.2f m/s^2 \nac = %0.2f m/s^2 \nek = %.2f J\nep = %.2f J\nem = %.2f J \nWf = %.2f J\ned = %0.2f J\nt = %.2f s', posX(i), posY(i), v(i), a(i), ac(i), ek(i), ep(i), (ek(i) + ep(i)), Wf(i), ed(i), t(i));
    valoress = sprintf('Distancia desde la zona de lanzamiento: %0.2f m', abs(posX(parar) - (posX(i))) + 0.76);
    cajita.String = valores;
    cajita2.String = valoress;
    if (posY(i) < 0)
        break;
    end
end 

%Recortar los vectores de manera que Ãºnicamente contengan valores que fueron simulados y no ceros.
ep_grafica = resize(ep, pararr);
ek_grafica = resize(ek, pararr);
em_grafica = resize(em, pararr);
ed_grafica = resize(ed, pararr);

dist = linspace(1, posX(pararr), pararr);

%GrÃ¡ficas de las energÃ­as
figure(2)
hold on

xlim([1,round(posX(pararr))+1]);

plot(dist, ep_grafica, "LineWidth", 2);

plot(dist, ek_grafica, "LineWidth", 2);

plot(dist, em_grafica, "LineWidth", 2);

plot(dist, ed_grafica, "LineWidth", 2);
xlabel("Trayectoria (metros recorridos)");
ylabel("EnergÃ­as (J)");
title("GrÃ¡fica EnergÃ­as durante el Movimiento")
legend("EnergÃ­a Potencial", "EnergÃ­a CinÃ©tica", "EnergÃ­a MecÃ¡nica", "EnergÃ­a Disipada");
